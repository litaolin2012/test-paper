(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["banner"],{"291a":function(t,e,a){"use strict";e["a"]={methods:{changeType:function(t,e,a){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"status";this.$axios.putJson(t,Object.assign({errorBack:!0},a)).then((function(t){var a=e[i];200===t.status?n.$message({message:"设置成功"}):(n.$message({message:"设置失败，请重试",type:"error"}),setTimeout((function(){e[i]=[1,0][a]}),300))}))}}}},"35a2":function(t,e,a){"use strict";var n=a("ea5c"),i=a.n(n);i.a},"575a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"banner"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.table,expression:"loading.table"}],staticClass:"table-content"},[a("div",{staticClass:"table-operate clearfix"},[a("div",{staticClass:"right"},[t.useEdit?a("ElButton",{attrs:{type:"primary",size:"small"},on:{click:function(e){return e.stopPropagation(),t.open()}}},[t._v(" 新增Banner ")]):t._e()],1)]),a("ElTable",{attrs:{data:t.tableData,border:!0}},[a("ElTableColumn",{attrs:{fixed:"left",align:"center",label:"Banner",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(a){a.stopPropagation(),t.rootLayout.artwork={src:[e.row.img],show:!0}}}},[a("img",{attrs:{src:e.row.img}})])]}}])}),a("ElTableColumn",{attrs:{prop:"jumpUrl",fixed:"left",align:"center",label:"跳转地址","min-width":"300"}}),a("ElTableColumn",{attrs:{align:"center",label:"状态","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("ElSwitch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.useEdit},on:{change:function(a){return t.changeType("admin/banners/"+e.row.id+"/"+e.row.status,e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}})]}}])}),a("ElTableColumn",{attrs:{align:"center",label:"类型","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("ElTag",[t._v(t._s(["首页banner","首页广告"][e.row.place]))])]}}])}),t.useEdit?a("ElTableColumn",{attrs:{fixed:"right",align:"center",label:"操作","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(a){return a.stopPropagation(),t.open(e.row)}}},[t._v("修改")])]}}],null,!1,2629766632)}):t._e()],1),a("Paging",{attrs:{"page-no":t.searchData.offset,"page-size":t.searchData.limit,total:t.total},on:{"update:pageNo":function(e){return t.$set(t.searchData,"offset",e)},"update:page-no":function(e){return t.$set(t.searchData,"offset",e)},"update:pageSize":function(e){return t.$set(t.searchData,"limit",e)},"update:page-size":function(e){return t.$set(t.searchData,"limit",e)},change:t.getData}})],1),t.useEdit?a("ElDialog",{attrs:{visible:t.dialog,title:(t.formData.id?"修改":"新增")+"Banner",top:"20vh",width:"500px"},on:{"update:visible":function(e){t.dialog=e},closed:function(e){return t.$refs.upload.clearFiles()}}},[a("ElForm",{ref:"formRef",attrs:{model:t.formData,rules:t.formRules,size:"small","label-width":"95px"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.stopPropagation(),!t.loadingServer.save&&t.save()}}},[a("ElFormItem",{staticClass:"form-upload is-required",attrs:{label:"Banner："}},[a("Upload",{ref:"upload",attrs:{status:t.uploadStatus},on:{"update:status":function(e){t.uploadStatus=e}},model:{value:t.imgList,callback:function(e){t.imgList=e},expression:"imgList"}})],1),a("ElFormItem",{attrs:{prop:"place",label:"显示位置："}},[a("el-select",{attrs:{placeholder:"请选择显示位置"},model:{value:t.formData.place,callback:function(e){t.$set(t.formData,"place",e)},expression:"formData.place"}},[a("el-option",{attrs:{value:0,label:"首页banner"}}),a("el-option",{attrs:{value:1,label:"首页广告"}})],1)],1),a("ElFormItem",{attrs:{prop:"jumpUrl",label:"跳转地址："}},[a("el-input",{attrs:{maxlength:32,autocomplete:"off",placeholder:"请输入跳转地址"},model:{value:t.formData.jumpUrl,callback:function(e){t.$set(t.formData,"jumpUrl",e)},expression:"formData.jumpUrl"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("ElButton",{attrs:{type:"primary",size:"small",loading:t.loadingServer.save},on:{click:function(e){return e.stopPropagation(),t.save()}}},[t._v(" 保 存 ")]),a("ElButton",{attrs:{type:"danger",size:"small"},on:{click:function(e){e.stopPropagation(),t.dialog=!1}}},[t._v("取 消")])],1)],1):t._e()],1)},i=[],s=a("a5e3"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ElUpload",{ref:"upload",staticClass:"upload",class:[t.className],attrs:{action:t.uploadFileURL,"list-type":"picture-card","before-upload":t.beforeUpload,"on-preview":t.onPreview,"on-remove":t.onRemove,"on-success":t.onSuccess,"on-error":t.onError,accept:".bmp,.jpg,.jpeg,.gif,.png","file-list":t.fileList,disabled:t.disabled,"set-disabled":t.setDisabled}},[a("i",{staticClass:"el-icon-plus"})])},o=[],l={computed:{rootLayout:function(){var t=this;while(t&&"layout"!==t.$options.name)t=t.$options.parent;return t}}},u=a("0f9a");function c(t){return d(t)||p(t)||g(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function d(t){if(Array.isArray(t))return b(t)}function m(t,e){return y(t)||v(t,e)||g(t,e)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,e){if(t){if("string"===typeof t)return b(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function v(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)if(a.push(r.value),e&&a.length===e)break}catch(l){i=!0,s=l}finally{try{n||null==o["return"]||o["return"]()}finally{if(i)throw s}}return a}}function y(t){if(Array.isArray(t))return t}var w={name:"Upload",mixins:[l],props:{value:{type:Array,required:!0},status:{type:Boolean,default:!1},length:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data:function(){return{change:!1,list:[],fileList:[],button:null,className:"upload".concat((new Date).getTime())}},computed:{config:function(){return this.$store.state.config},uploadFileURL:function(){return this.$store.getters.uploadFileURL},imageUrl:function(){return"".concat(this.config.IMAGE_URL,"148")},setDisabled:function(){return this.setButton(),this.disabled}},watch:{value:function(){this.setFileList(),this.setButton()}},mounted:function(){this.setFileList();var t=document.querySelectorAll(".".concat(this.className," .el-upload")),e=m(t,1);this.button=e[0],this.setButton()},methods:{setFileList:function(){var t=this;if(this.change)this.change=!this.change;else{var e;(e=this.list).splice.apply(e,[0,this.list.length].concat(c(this.value)));var a=[];this.list.map((function(e){return a.push({url:e+t.imageUrl,response:{url:e}})})),this.fileList=a}},setButton:function(){this.button&&(this.disabled?this.button.setAttribute("style","display: none;"):this.button.setAttribute("style","opacity: ".concat(this.list.length===this.length?0:1,";")))},beforeUpload:function(t){var e=t.name,a=t.size,n=t.uid,i=e.toLowerCase().split(".").pop();return"bmp"!==i&&"jpg"!==i&&"jpeg"!==i&&"gif"!==i&&"png"!==i?(this.$message({message:"请选择图片",type:"warning"}),!1):a>10485760?(this.$message({message:"图片大小不能超过10M",type:"warning"}),!1):(this.list.push(n),this.setButton(),this.$emit("update:status",!0),!0)},onPreview:function(t){var e=t.response;e?this.rootLayout.artwork={src:this.list,show:!0,active:this.list.indexOf(e.url)}:this.$message({message:"图片还未上传完成",type:"warning"})},onRemove:function(t){var e=t.response,a=t.uid;this.list.splice(this.list.indexOf(e?e.url:a),1),this.change=!0,this.$emit("input",c(this.list)),this.setButton();var n=this.list.findIndex((function(t){var e=String(t);return!(e.includes("http://")||e.includes("https://"))}));return!(n>-1)&&this.$emit("update:status",!1)},onSuccess:function(t,e){var a=this,n=t.url,i=!1;this.list.map((function(t,s){var r=String(t);return t===e.uid&&(r=n,a.list.splice(s,1,n),a.change=!0,a.$emit("input",c(a.list))),i||(i=!(r.includes("http://")||r.includes("https://"))),!0})),i||this.$emit("update:status",!1)},onError:function(t){var e=JSON.parse(String(t).substring(6)),a=e.status,n=e.message;401===a&&this.$store.commit(u["d"]),this.$message({message:n,type:"error"})},clearFiles:function(){this.$refs.upload.clearFiles(),this.list=[],this.$emit("input",[]),this.button.setAttribute("style","opacity: 1;")}}},$=w,D=(a("6624"),a("35a2"),a("4023")),E=Object(D["a"])($,r,o,!1,null,"1b863b3a",null),S=E.exports,j=a("291a"),x=a("844d"),k={name:"Banner",components:{Paging:s["a"],Upload:S},mixins:[l,j["a"]],data:function(){return{loading:{table:!1},searchData:{offset:1,limit:10},total:0,tableData:[],dialog:!1,uploadStatus:!1,imgList:[],formData:{id:"",img:"",place:"",jumpUrl:""},formRules:{place:[{required:!0,message:"请选择显示位置",trigger:"change"}],jumpUrl:[{validator:this.$verify({required:!1,text:"跳转地址",type:"Http"}),trigger:"blur"}]}}},computed:{useEdit:function(){return this.$store.state.user.permissions.includes("admin:banner:edit")},loadingServer:function(){return this.$store.state.loadingServer}},created:function(){this.$store.dispatch(x["c"],{names:"save"}),this.getData()},methods:{search:function(){this.searchData.offset=1,this.getData()},getData:function(){var t=this;this.loading.table=!0,this.$axios.get("admin/banners",Object.assign({},this.searchData,{offset:this.searchData.offset-1})).then((function(e){var a=e.data;t.tableData=a.data,t.total=a.recordsTotal,t.loading.table=!1}))},open:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.id,n=e.img,i=e.place,s=e.jumpUrl;this.dialog=!0,this.$formClear().then((function(){a?(t.imgList.splice(0,t.imgList.length,n),Object.assign(t.formData,{id:a,place:i,jumpUrl:s})):Object.assign(t.formData,{id:"",place:0})}))},save:function(){var t=this;this.$refs.formRef.validate((function(e){if(e){if(t.uploadStatus)return t.$message({message:"图片上传中",type:"warning"}),!1;if(!t.imgList[0])return t.$message({message:"请上传Banner",type:"warning"}),!1;t.$store.dispatch(x["a"],{save:!0});var a=t.formData.id;t.formData.img=t.imgList.join(","),t.$axios[a?"putJson":"postJson"]("admin/banners",t.formData).then((function(){t.$message({message:"".concat(a?"修改":"新增","成功"),onClose:function(){a||(t.searchData.offset=1),t.getData(),t.dialog=!1,t.$store.dispatch(x["a"],{save:!1})}})}))}return!1}))}}},L=k,U=(a("febf"),Object(D["a"])(L,n,i,!1,null,"a3caab30",null));e["default"]=U.exports},6624:function(t,e,a){"use strict";var n=a("67f9"),i=a.n(n);i.a},"67f9":function(t,e,a){},ea5c:function(t,e,a){},ec8d:function(t,e,a){},febf:function(t,e,a){"use strict";var n=a("ec8d"),i=a.n(n);i.a}}]);